<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bench</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { display: flex; }
        .section { flex: 1; padding: 10px; }
        #plot { text-align: center; }
        .plot {
            display: inline-block;
            margin: 10px;
        }
        .video-container { width: 300px; height: 200px; overflow: hidden; } /* Adjust size here */
        img { width: 100%; height: auto; } /* Make images responsive */
    </style>
</head>
<body>
    <div class="section" id="plot">
        <h2>XY Coordinate Plot</h2>
        <div id="plot-container"></div>
    </div>

    <script>
        // Fetch the JSON data from the Flask route
        fetch('/plot_data')
            .then(response => response.json())
            .then(data => {
                const width = 500;
                const height = 500;
                const margin = { top: 20, right: 20, bottom: 100, left: 40 }; // Extra space for legend

                const svg = d3.select("#plot-container")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const xScale = d3.scaleLinear()
                    .domain([0, d3.max(data.designed.x)])
                    .range([0, width]);

                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(data.designed.y)])
                    .range([height, 0]);

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(xScale));

                svg.append("g")
                    .call(d3.axisLeft(yScale));

                // Plot designed points
                svg.selectAll(".designed")
                    .data(data.designed.x.map((d, i) => ({ x: d, y: data.designed.y[i], id: data.hole_id[i] })))
                    .enter().append("circle")
                    .attr("class", "designed")
                    .attr("cx", d => xScale(d.x))
                    .attr("cy", d => yScale(d.y))
                    .attr("r", 5)
                    .attr("fill", "none")
                    .attr("stroke", "black");

                // Add labels for designed points
                svg.selectAll(".designed-label")
                    .data(data.designed.x.map((d, i) => ({ x: d, y: data.designed.y[i], id: data.hole_id[i] })))
                    .enter().append("text")
                    .attr("class", "designed-label")
                    .attr("x", d => xScale(d.x) + 5)
                    .attr("y", d => yScale(d.y) - 5)
                    .text(d => d.id)
                    .attr("font-size", "12px")
                    .attr("fill", "black");

                // Plot completed points
                svg.selectAll(".completed")
                    .data(data.completed.x.map((d, i) => ({ x: d, y: data.completed.y[i] })))
                    .enter().append("circle")
                    .attr("class", "completed")
                    .attr("cx", d => xScale(d.x))
                    .attr("cy", d => yScale(d.y))
                    .attr("r", 5)
                    .attr("fill", d => {
                        const designedPoint = data.designed.x.map((dx, i) => ({ x: dx, y: data.designed.y[i] }))
                            .find(dp => Math.abs(dp.x - d.x) < 0.15 && Math.abs(dp.y - d.y) < 0.15);
                        return designedPoint ? "green" : "red";
                    });

                // Plot current point
                svg.append("circle")
                    .attr("class", "current")
                    .attr("cx", xScale(data.current.x))
                    .attr("cy", yScale(data.current.y))
                    .attr("r", 5)
                    .attr("fill", "blue");

                // Add legend at the bottom of the plot
                const legend = svg.append("g")
                    .attr("class", "legend")
                    .attr("transform", `translate(0,${height + 40})`);

                // Legend items
                const legendData = [
                    { label: "Designed Points", color: "none", stroke: "black" },
                    { label: "Completed Points (Match)", color: "green" },
                    { label: "Completed Points (Mismatch)", color: "red" },
                    { label: "Current Point", color: "blue" }
                ];

                // Add legend circles and text
                legend.selectAll(".legend-item")
                    .data(legendData)
                    .enter().append("g")
                    .attr("class", "legend-item")
                    .attr("transform", (d, i) => `translate(${(i % 2) * 200}, ${Math.floor(i / 2) * 20})`)
                    .each(function(d) {
                        d3.select(this).append("circle")
                            .attr("cx", 5)
                            .attr("cy", 5)
                            .attr("r", 5)
                            .attr("fill", d.color)
                            .attr("stroke", d.stroke || "none");

                        d3.select(this).append("text")
                            .attr("x", 20)
                            .attr("y", 10)
                            .text(d.label)
                            .attr("font-size", "12px");
                    });
            });
    </script>
    <div class="section">
        <h2>Video Stream 1</h2>
        <div class="video-container">
            <img src="{{ url_for('video_feed_0') }}" alt="Video Stream 1">
        </div>
        <h2>Video Stream 2</h2>
        <div class="video-container">
            <img src="{{ url_for('video_feed_1') }}" alt="Video Stream 2">
        </div>
    </div>
    <div class="section">
<!--        <h2>Dynamic JSON Data</h2>-->
<!--        <pre id="json-data"></pre>-->
<!--        <script>-->
<!--            async function fetchJsonData() {-->
<!--                const response = await fetch('/dynamic_json');-->
<!--                const data = await response.json();-->
<!--                document.getElementById('json-data').textContent = JSON.stringify(data, null, 2);-->
<!--            }-->
<!--            setInterval(fetchJsonData, 5000); // Fetch every 5 seconds-->
<!--        </script>-->
    </div>
</body>
</html>